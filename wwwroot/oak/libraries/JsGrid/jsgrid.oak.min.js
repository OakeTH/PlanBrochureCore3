(function(n,t,i){function e(n,i){var u=t(n);u.data(o,this);this._container=u;this.data=[];this.fields=[];this._editingRow=null;this._sortField=null;this._sortOrder=r;this._firstDisplayingPage=1;this._init(i);this.render()}n.JSGRIDadded=!0;var o="JSGrid",u="JSGridItem",s="JSGridEditRow",r="asc",v="desc",y="{first}",p="{pages}",w="{prev}",b="{next}",k="{last}",d="{pageIndex}",g="{pageCount}",nt="{itemCount}",tt="javascript:void(0);",f=function(n,i){return t.isFunction(n)?n.apply(i,t.makeArray(arguments).slice(2)):n},it=function(n){var i=t.Deferred();return n&&n.then?n.then(function(){i.resolve.apply(i,arguments)},function(){i.reject.apply(i,arguments)}):i.resolve(n),i.promise()},h={loadData:t.noop,insertItem:t.noop,updateItem:t.noop,deleteItem:t.noop};e.prototype={width:"100%",height:"auto",updateOnResize:!0,rowClass:"jsgRow",rowRenderer:null,rowClick:function(n){this.editing&&this.editItem(t(n.event.target).closest("tr"))},rowDoubleClick:t.noop,noDataContent:oakdef.gridempty_data,noDataRowClass:"jsgrid-nodata-row",heading:!0,headerRowRenderer:null,headerRowClass:"jsgrid-header-row flex-row",headerCellClass:"jsgH-C",filtering:!0,filterRowRenderer:null,filterRowClass:"jsgrid-filter-row",inserting:!1,insertRowRenderer:null,insertRowClass:"jsgrid-insert-row",editing:!1,editRowRenderer:null,editRowClass:"jsgrid-edit-row",confirmDeleting:!0,deleteConfirm:"Are you sure?",selecting:!0,selectedRowClass:"jsgrid-selected-row",oddRowClass:"jsgR-O",evenRowClass:"jsgR-E",cellClass:"jsgC",sorting:!0,sortableClass:"jsgH-Sort",sortAscClass:"jsgrid-header-sort jsgrid-header-sort-asc",sortDescClass:"jsgrid-header-sort jsgrid-header-sort-desc",paging:!0,pagerContainer:null,pageIndex:1,pageSize:20,pageButtonCount:10,pagerFormat:"Pages {pageIndex} of {pageCount} &nbsp;&nbsp; {first} {prev} {pages} {next} {last}",pagePrevText:"<",pageNextText:">",pageFirstText:"First",pageLastText:"Last",pageNavigatorNextText:"...",pageNavigatorPrevText:"...",pagerContainerClass:"jsgrid-pager-container",pagerClass:"jsgrid-pager bar jus-center align-i-center",pagerNavButtonClass:"jsgP-nav-button",pagerNavButtonInactiveClass:"sgP-nav-nav-inactive-button",pageClass:"jsgP",currentPageClass:"jsgrid-pager-current-page",customLoading:!1,pageLoading:!1,autoload:!0,controller:h,loadIndication:!0,loadIndicationDelay:500,loadMessage:"Please, wait...",loadShading:!0,invalidMessage:"Invalid data entered!",invalidNotify:function(i){var r=t.map(i.errors,function(n){return n.message||null});n.alert([this.invalidMessage].concat(r).join("\n"))},onInit:t.noop,onRefreshing:t.noop,onRefreshed:t.noop,onPageChanged:t.noop,onItemDeleting:t.noop,onItemDeleted:t.noop,onItemInserting:t.noop,onItemInserted:t.noop,onItemEditing:t.noop,onItemUpdating:t.noop,onItemUpdated:t.noop,onItemInvalid:t.noop,onDataLoading:t.noop,onDataLoaded:t.noop,onOptionChanging:t.noop,onOptionChanged:t.noop,onError:t.noop,invalidClass:"jsgrid-invalid",containerClass:"jsgrid bar align-s-stretch",tableClass:"jsgrid-table align-s-stretch flex-column",gridHeaderClass:"jsgrid-grid-header flex-column",gridBodyClass:"jsgrid-grid-body flex-column",_init:function(n){t.extend(this,n);this._initLoadStrategy();this._initController();this._initFields();this._attachWindowLoadResize();this._attachWindowResizeCallback();this._callEventHandler(this.onInit)},loadStrategy:function(){return this.pageLoading?new jsGrid.loadStrategies.PageLoadingStrategy(this):new jsGrid.loadStrategies.DirectLoadingStrategy(this)},_initLoadStrategy:function(){this._loadStrategy=f(this.loadStrategy,this)},_initController:function(){this._controller=t.extend({},h,f(this.controller,this))},renderTemplate:function(n,t,r){args=[];for(var u in r)args.push(r[u]);return args.unshift(n,t),n=f.apply(null,args),n===i||n===null?"":n},loadIndicator:function(n){return new jsGrid.LoadIndicator(n)},validation:function(n){return jsGrid.Validation&&new jsGrid.Validation(n)},_initFields:function(){var n=this;n.fields=t.map(n.fields,function(i){if(t.isPlainObject(i)){var r=i.type&&jsGrid.fields[i.type]||jsGrid.Field;i=new r(i)}return i._grid=n,i})},_attachWindowLoadResize:function(){t(n).on("load",t.proxy(this._refreshSize,this))},_attachWindowResizeCallback:function(){if(this.updateOnResize)t(n).on("resize",t.proxy(this._refreshSize,this))},_detachWindowResizeCallback:function(){t(n).off("resize",this._refreshSize)},option:function(n,t){var i,r;if(arguments.length===1)return this[n];i={option:n,oldValue:this[n],newValue:t};this._callEventHandler(this.onOptionChanging,i);this._handleOptionChange(i.option,i.newValue);r={option:i.option,value:i.newValue};this._callEventHandler(this.onOptionChanged,r)},fieldOption:function(n,t,i){if(n=this._normalizeField(n),arguments.length===2)return n[t];n[t]=i;this._renderGrid()},_handleOptionChange:function(n,t){this[n]=t;switch(n){case"width":case"height":this._refreshSize();break;case"rowClass":case"rowRenderer":case"rowClick":case"rowDoubleClick":case"noDataRowClass":case"noDataContent":case"selecting":case"selectedRowClass":case"oddRowClass":case"evenRowClass":this._refreshContent();break;case"pageButtonCount":case"pagerFormat":case"pagePrevText":case"pageNextText":case"pageFirstText":case"pageLastText":case"pageNavigatorNextText":case"pageNavigatorPrevText":case"pagerClass":case"pagerNavButtonClass":case"pageClass":case"currentPageClass":case"pagerRenderer":this._refreshPager();break;case"fields":this._initFields();this.render();break;case"data":case"editing":case"heading":case"filtering":case"inserting":case"paging":this.refresh();break;case"loadStrategy":case"pageLoading":this._initLoadStrategy();this.search();break;case"pageIndex":this.openPage(t);break;case"pageSize":this.refresh();this.search();break;case"editRowRenderer":case"editRowClass":this.cancelEdit();break;case"updateOnResize":this._detachWindowResizeCallback();this._attachWindowResizeCallback();break;case"invalidNotify":case"invalidMessage":break;default:this.render()}},destroy:function(){this._detachWindowResizeCallback();this._clear();this._container.removeData(o)},render:function(){return this._renderGrid(),this.autoload?this.loadData():t.Deferred().resolve().promise()},_renderGrid:function(){this._clear();this._container.addClass(this.containerClass).append(this._createHeader()).append(this._createBody());this.gridcss&&(this.gridcss.includes("align-s")&&this._container.removeClass("align-s-stretch"),this._container.addClass(this.gridcss));this.theme&&this._container.addClass(this.theme);this._pagerContainer=this._createPagerContainer();this._validation=this._createValidation();this.refresh()},_createValidation:function(){return f(this.validation,this)},_clear:function(){this.cancelEdit();clearTimeout(this._loadingTimer);this._pagerContainer&&this._pagerContainer.empty();this._container.empty().css({position:"",width:"",height:""})},_createHeader:function(){var n=this._headerRow=this._createHeaderRow(),i=this._filterRow=this._createFilterRow(),r=this._headerGrid=t("<table>").addClass(this.tableClass).append(n).append(i);return this._header=t("<div>").addClass(this.gridHeaderClass).append(r)},_createBody:function(){var n=this._content=t("<tbody>"),i=this._bodyGrid=t("<table>").addClass(this.tableClass).append(n);return this._body=t("<div>").addClass(this.gridBodyClass).append(i).on("scroll",t.proxy(function(n){this._header.scrollLeft(n.target.scrollLeft)},this))},_createPagerContainer:function(){var n=this.pagerContainer||t("<div>").appendTo(this._container);return t(n).addClass(this.pagerContainerClass)},_eachField:function(n){var i=this;t.each(this.fields,function(t,r){r.visible&&n.call(i,r,t)})},_createHeaderRow:function(){if(t.isFunction(this.headerRowRenderer))return t(this.renderTemplate(this.headerRowRenderer,this));var n=t("<tr>").addClass(this.headerRowClass);return this._eachField(function(i,r){var u=this._prepareHeaderCell("<th>",i,"headercss",this.headerCellClass).append(this.renderTemplate(i.headerTemplate,i)).appendTo(n);if(this.sorting&&i.sorting)u.on("click",t.proxy(function(){this.sort(r)},this))}),n},_prepareCell:function(n,t){return t.align!==""&&(n[0].style.textAlign=t.align),t.css!==""&&n[0].classList.add(t.css),n[0].style.width=t.width+"px",n},_prepareFilterCell:function(n,i){return i.headercss?t(n).addClass(i.headercss):t(n).css("width",i.width)},_prepareHeaderCell:function(n,i){return t(n).css("width",i.width).addClass(i.headercss?i.headercss:"")},_createFilterRow:function(){if(t.isFunction(this.filterRowRenderer))return t(this.renderTemplate(this.filterRowRenderer,this));var n=t("<tr>").addClass(this.filterRowClass);return this._eachField(function(t){this._prepareFilterCell("<td>",t,"filtercss").append(this.renderTemplate(t.filterTemplate,t)).appendTo(n)}),n},_callEventHandler:function(n,i){return n.call(this,t.extend(i,{grid:this})),i},reset:function(){return this._resetSorting(),this._resetPager(),this._loadStrategy.reset()},_resetPager:function(){this._firstDisplayingPage=1;this._setPage(1)},_resetSorting:function(){this._sortField=null;this._sortOrder=r;this._clearSortingCss()},refresh:function(){this._callEventHandler(this.onRefreshing);this.cancelEdit();this._refreshHeading();this._refreshFiltering();this._refreshContent();this._refreshPager();this._refreshSize();this._callEventHandler(this.onRefreshed)},_refreshHeading:function(){this._headerRow.toggle(this.heading)},_refreshFiltering:function(){this.hideInternalSearch?this._filterRow.toggle(!1):this._filterRow.toggle(this.filtering)},_refreshContent:function(){var t=this._content,i,r,n,u;if(t.empty(),this.data.length)this._pagerContainer[0].style.display="";else return this._pagerContainer[0].style.display="none",t.append(this._createNoDataRow()),this;for(i=this._loadStrategy.firstDisplayIndex(),r=this._loadStrategy.lastDisplayIndex(),n=i;n<r;n++)u=this.data[n],t.append(this._createRow(u,n))},_createNoDataRow:function(){var n=this._container[0].getBoundingClientRect().width+"px";return t("<tr>").addClass(this.noDataRowClass).append(t("<td>").addClass(this.cellClass).css("width",n).append(this.renderTemplate(this.noDataContent,this)))},_createRow:function(n,i){var r;t.isFunction(this.rowRenderer)?r=this.renderTemplate(this.rowRenderer,this,{item:n,itemIndex:i}):(r=t("<tr>"),this._renderCells(r,n));r.addClass(this._getRowClasses(n,i)).data(u,n).on("click",t.proxy(function(t){this.rowClick({item:n,itemIndex:i,event:t})},this));return this.selecting&&this._attachRowHover(r),r},_getRowClasses:function(n,t){var i=[];return i.push(f(this.rowClass,this,n,t)),i.join(" ")},_attachRowHover:function(n){var i=this.selectedRowClass;n.hover(function(){t(this).addClass(i)},function(){t(this).removeClass(i)})},_renderCells:function(n,t){return this._eachField(function(i){n.append(this._createCell(t,i))}),this},_createCell:function(n,i){var r,u=this._getItemFieldValue(n,i),f={value:u,item:n};return r=t("<td>").append(this.renderTemplate(i.itemTemplate||u,i,f)),this._prepareCell(r,i)},_getItemFieldValue:function(n,t){for(var r=t.name.split("."),i=n[r.shift()];i&&r.length;)i=i[r.shift()];return i},_setItemFieldValue:function(n,t,i){for(var r=t.name.split("."),f=n,u=r[0];f&&r.length;)n=f,u=r.shift(),f=n[u];if(!f)while(r.length)n=n[u]={},u=r.shift();n[u]=i},sort:function(n,i){return t.isPlainObject(n)&&(i=n.order,n=n.field),this._clearSortingCss(),this._setSortingParams(n,i),this._setSortingCss(),this._loadStrategy.sort()},_clearSortingCss:function(){this._headerRow.find("th").removeClass(this.sortAscClass).removeClass(this.sortDescClass)},_setSortingParams:function(n,t){n=this._normalizeField(n);t=t||(this._sortField===n?this._reversedSortOrder(this._sortOrder):r);this._sortField=n;this._sortOrder=t},_normalizeField:function(n){return t.isNumeric(n)?this.fields[n]:typeof n=="string"?t.grep(this.fields,function(t){return t.name===n})[0]:n},_reversedSortOrder:function(n){return n===r?v:r},_setSortingCss:function(){var n=this._visibleFieldIndex(this._sortField);this._headerRow.find("th").eq(n).addClass(this._sortOrder===r?this.sortAscClass:this.sortDescClass)},_visibleFieldIndex:function(n){return t.inArray(n,t.grep(this.fields,function(n){return n.visible}))},_sortData:function(){var t=this._sortFactor(),n=this._sortField;n&&this.data.sort(function(i,r){return t*n.sortingFunc(i[n.name],r[n.name])})},_sortFactor:function(){return this._sortOrder===r?1:-1},_itemsCount:function(){return this._loadStrategy.itemsCount()},_pagesCount:function(){var n=this._itemsCount(),t=this.pageSize;return Math.floor(n/t)+(n%t?1:0)},_refreshPager:function(){var n=this._pagerContainer;n.empty();this.paging&&n.append(this._createPager())},_createPager:function(){var i;if(i=t("<div>").append(this._createPagerByFormat()),this.excelbutton){let r=t("<input/>",{value:"Export to",type:"button"}).addClass("jsgrid-btn-expToExcel").data("gridID",this._container[0].id);r.on("click",function(){var u=t.data(this,"gridID"),r;let i=t.map(jsGrid.oakfn[u].fields,function(n){return n.type==="control"?!1:n.name&&!n.forhide?n.topics:n.name&&n.forhide?n.topics+"^,hide":void 0});i=t.grep(i,function(n){return n!=!1});let f=jsGrid.oakfn[u].data;oak.ajaxpost.redirect({url:SV.DownloadExcelFromJsonfn,fields:i,data:f});r=t(this);r.processingButton({color:"#ebebeb",value:!1});n.setTimeout(function(){r.processingButton(!1)},2e3)});i.append(r)}return i.addClass(this.pagerClass),i},_createPagerByFormat:function(){var n=this.pageIndex,i=this._pagesCount(),r=this._itemsCount(),u=this.pagerFormat.split(" ");return t.map(u,t.proxy(function(u){var f=u;return u===p?f=this._createPages():u===y?f=this._createPagerNavButton(this.pageFirstText,1,n>1):u===w?f=this._createPagerNavButton(this.pagePrevText,n-1,n>1):u===b?f=this._createPagerNavButton(this.pageNextText,n+1,n<i):u===k?f=this._createPagerNavButton(this.pageLastText,i,n<i):u===d?f=n:u===g?f=i:u===nt&&(f=r),t.isArray(f)?f.concat([" "]):[f," "]},this))},_createPages:function(){var u=this._pagesCount(),f=this.pageButtonCount,i=this._firstDisplayingPage,t=[],r,n;for(i>1&&t.push(this._createPagerPageNavButton(this.pageNavigatorPrevText,this.showPrevPages)),r=0,n=i;r<f&&n<=u;r++,n++)t.push(n===this.pageIndex?this._createPagerCurrentPage():this._createPagerPage(n));return i+f-1<u&&t.push(this._createPagerPageNavButton(this.pageNavigatorNextText,this.showNextPages)),t},_createPagerNavButton:function(n,i,r){var u="";return(n==this.pagePrevText||n==this.pageNextText)&&(u=" dark"),this._createPagerButton(n,this.pagerNavButtonClass+u,r?function(){this.openPage(i)}:t.noop)},_createPagerPageNavButton:function(n,t){return this._createPagerButton(n,this.pagerNavButtonClass+" dark",t)},_createPagerPage:function(n){return this._createPagerButton(n,this.pageClass,function(){this.openPage(n)})},_createPagerButton:function(n,i,r){var u=t("<a>").attr("href",tt).html(n).on("click",t.proxy(r,this));return t("<span>").addClass(i).append(u)},_createPagerCurrentPage:function(){return t("<span>").addClass(this.pageClass).addClass(this.currentPageClass).text(this.pageIndex)},_refreshSize:function(){},_refreshWidth:function(){var t=this._headerGrid,i=this._bodyGrid,n=this.width;t.width("");i.width("");this._container.width(n);n=t.outerWidth();i.width(n)},_scrollBarWidth:function(){var n;return function(){var r,u,f,e;return n===i&&(r=t("<div style='width:50px;height:50px;overflow:hidden;position:absolute;top:-10000px;left:-10000px;'><\/div>"),u=t("<div style='height:100px;'><\/div>"),r.append(u).appendTo("body"),f=u.innerWidth(),r.css("overflow-y","auto"),e=u.innerWidth(),r.remove(),n=f-e),n}}(),_refreshHeight:function(){var t=this._container,r=this._pagerContainer,n=this.height,i;t.height(n);n!=="auto"&&(n=t.height(),i=this._header.outerHeight(!0),r.parents(t).length&&(i+=r.outerHeight(!0)),this._body.outerHeight(n-i))},showPrevPages:function(){var n=this._firstDisplayingPage,t=this.pageButtonCount;this._firstDisplayingPage=n>t?n-t:1;this._refreshPager()},showNextPages:function(){var t=this._firstDisplayingPage,n=this.pageButtonCount,i=this._pagesCount();this._firstDisplayingPage=t+2*n>i?i-n+1:t+n;this._refreshPager()},openPage:function(n){n<1||n>this._pagesCount()||(this._setPage(n),this._loadStrategy.openPage(n))},_setPage:function(n){var t=this._firstDisplayingPage,i=this.pageButtonCount;this.pageIndex=n;n<t&&(this._firstDisplayingPage=n);n>t+i-1&&(this._firstDisplayingPage=n-i+1);this._callEventHandler(this.onPageChanged,{pageIndex:n})},_controllerCall:function(n,i,r,u){if(r)return t.Deferred().reject().promise();var f=this._controller;if(!f||!f[n])throw Error("controller has no method '"+n+"'");return it(f[n](i)).done(t.proxy(u,this)).fail(t.proxy(this._errorHandler,this)).always(t.proxy(this._hideLoading,this))},_errorHandler:function(){this._callEventHandler(this.onError,{args:t.makeArray(arguments)})},_hideLoading:function(){this.loadIndication&&clearTimeout(this._loadingTimer)},search:function(){return this._resetSorting(),this._resetPager(),this.loadData(!0)},loadData:function(n){var t,i;if(n){n=[];n=this.getFilter();for(t in n)n[t]===""&&delete n[t];Object.keys(n).length===0&&(n=null)}else n=null;return i=this._callEventHandler(this.onDataLoading,{filter:n}),this._controllerCall("loadData",n,i.cancel,function(n){n&&(this._loadStrategy.finishLoad(n),this._callEventHandler(this.onDataLoaded,{data:n}))})},getFilter:function(){var n={};return this._eachField(function(t){t.filtering&&this._setItemFieldValue(n,t,t.filterValue())}),n},_sortingParams:function(){return this.sorting&&this._sortField?{sortField:this._sortField.name,sortOrder:this._sortOrder}:{}},getSorting:function(){var n=this._sortingParams();return{field:n.sortField,order:n.sortOrder}},clearFilter:function(){var n=this._createFilterRow();return this._filterRow.replaceWith(n),this._filterRow=n,this.search()},insertItem:function(n){var i=n||this._getValidatedInsertItem(),r;return i?(r=this._callEventHandler(this.onItemInserting,{item:i}),this._controllerCall("insertItem",i,r.cancel,function(n){n=n||i;this._loadStrategy.finishInsert(n);this._callEventHandler(this.onItemInserted,{item:n})})):t.Deferred().reject().promise()},_getValidatedInsertItem:function(){},_getInsertItem:function(){var n={};return this._eachField(function(t){t.inserting&&this._setItemFieldValue(n,t,t.insertValue())}),n},_validateItem:function(n,r){var u=[],e={item:n,itemIndex:this._rowIndex(r),row:r},f;return(this._eachField(function(f){var s,o;f.validate&&(s=this._getItemFieldValue(n,f),s!==i)&&(o=this._validation.validate(t.extend({value:s,rules:f.validate},e)),this._setCellValidity(r.children().eq(this._visibleFieldIndex(f)),o),o.length)&&u.push.apply(u,t.map(o,function(n){return{field:f,message:n}}))}),!u.length)?!0:(f=t.extend({errors:u},e),this._callEventHandler(this.onItemInvalid,f),this.invalidNotify(f),!1)},_setCellValidity:function(n,t){n.toggleClass(this.invalidClass,!!t.length).attr("title",t.join("\n"))},clearInsert:function(){},editItem:function(n){var t=this.rowByItem(n);t.length&&this._editRow(t)},rowByItem:function(n){return n.jquery||n.nodeType?t(n):this._content.find("tr").filter(function(){return t.data(this,u)===n})},_editRow:function(n){var t,r,i;this.editing&&((t=n.data(u),r=this._callEventHandler(this.onItemEditing,{row:n,item:t,itemIndex:this._itemIndex(t)}),r.cancel)||(this._editingRow&&this.cancelEdit(),i=this._createEditRow(t),this._editingRow=n,n.hide(),i.insertBefore(n),n.data(s,i)))},_createEditRow:function(n){if(t.isFunction(this.editRowRenderer))return t(this.renderTemplate(field.editRowRenderer,field,{item:n,itemIndex:this._itemIndex(n)}));var i=t("<tr>").addClass(this.editRowClass);return this._eachField(function(t){var r=this._getItemFieldValue(n,t);this._prepareCell("<td>",t,"editcss").append(this.renderTemplate(t.editTemplate||"",t,{value:r,item:n})).appendTo(i)}),i},updateItem:function(n,t){arguments.length===1&&(t=n);var i=n?this.rowByItem(n):this._editingRow;if(t=t||this._getValidatedEditedItem(),t)return this._updateRow(i,t)},_getValidatedEditedItem:function(){var n=this._getEditedItem();return this._validateItem(n,this._getEditRow())?n:null},_updateRow:function(n,i){var r=n.data(u),f=this._itemIndex(r),e=t.extend(!0,{},r),o;return t.extend(!0,r,i),o=this._callEventHandler(this.onItemUpdating,{row:n,item:r,itemIndex:f,previousItem:e}),this._controllerCall("updateItem",r,o.cancel,function(t){t=t||r;var i=this._finishUpdate(n,t,f);this._callEventHandler(this.onItemUpdated,{row:i,item:t,itemIndex:f,previousItem:e})})},_rowIndex:function(n){return this._content.children().index(t(n))},_itemIndex:function(n){return t.inArray(n,this.data)},_finishUpdate:function(n,t,i){this.cancelEdit();this.data[i]=t;var r=this._createRow(t,i);return r.addClass("rowupdated"),n.replaceWith(r),r},_getEditedItem:function(){var n={};return this._eachField(function(t){t.editing&&this._setItemFieldValue(n,t,t.editValue())}),n},cancelEdit:function(){this._editingRow&&(this._getEditRow().remove(),this._editingRow.show(),this._editingRow=null)},_getEditRow:function(){return this._editingRow.data(s)},deleteItem:function(n){var t=this.rowByItem(n);if(t.length)return this._deleteRow(t)},_deleteRow:function(n){var t=n.data(u),i=this._itemIndex(t),r=this._callEventHandler(this.onItemDeleting,{row:n,item:t,itemIndex:i});return this._controllerCall("deleteItem",t,r.cancel,function(){this._loadStrategy.finishDelete(t,i);this._callEventHandler(this.onItemDeleted,{row:n,item:t,itemIndex:i})})}};t.fn.jsGrid=function(n){var u=t.makeArray(arguments),f=u.slice(1),r=this;return this.each(function(){var h=t(this),u=h.data(o),s;if(u)if(typeof n=="string"){if(s=u[n].apply(u,f),s!==i&&s!==u)return r=s,!1}else u._detachWindowResizeCallback(),u._init(n),u.render();else new e(h,n),t.isFunction(n.onHeaderRendered)&&n.onHeaderRendered()}),r};var c={},rt=function(n){var i;t.isPlainObject(n)?i=e.prototype:(i=c[n].prototype,n=arguments[1]||{});t.extend(i,n)},l={},ut=function(n){var i=t.isPlainObject(n)?n:l[n];if(!i)throw Error("unknown locale "+n);a(jsGrid,i)},a=function(n,i){t.each(i,function(i,r){if(t.isPlainObject(r)){a(n[i]||n[i[0].toUpperCase()+i.slice(1)],r);return}n.hasOwnProperty(i)?n[i]=r:n.prototype[i]=r})};n.jsGrid={Grid:e,fields:c,setDefaults:rt,locales:l,locale:ut,version:"1.5.2"}})(window,jQuery),function(n,t){function i(n){this._init(n)}i.prototype={container:"body",message:"Loading...",shading:!0,zIndex:1e3,_init:function(n){t.extend(!0,this,n);this._initContainer()},_initContainer:function(){this._container=t(this.container)},show:function(){},hide:function(){}};n.LoadIndicator=i}(jsGrid,jQuery),function(n,t){function i(n){this._grid=n}function r(n){this._grid=n;this._itemsCount=0}i.prototype={firstDisplayIndex:function(){var n=this._grid;return n.option("paging")?(n.option("pageIndex")-1)*n.option("pageSize"):0},lastDisplayIndex:function(){var n=this._grid,t=n.option("data").length;return n.option("paging")?Math.min(n.option("pageIndex")*n.option("pageSize"),t):t},itemsCount:function(){return this._grid.option("data").length},openPage:function(){this._grid.refresh()},loadParams:function(){return{}},sort:function(){return this._grid._sortData(),this._grid.refresh(),t.Deferred().resolve().promise()},reset:function(){return this._grid.refresh(),t.Deferred().resolve().promise()},finishLoad:function(n){this._grid.option("data",n)},finishInsert:function(n){var t=this._grid;t.option("data").unshift(n);t.refresh()},finishDelete:function(n,t){var i=this._grid;i.option("data").splice(t,1);i.reset()}};r.prototype={firstDisplayIndex:function(){return 0},lastDisplayIndex:function(){return this._grid.option("data").length},itemsCount:function(){return this._itemsCount},openPage:function(){this._grid.loadData()},loadParams:function(){var n=this._grid;return{pageIndex:n.option("pageIndex"),pageSize:n.option("pageSize")}},reset:function(){return this._grid.loadData()},sort:function(){return this._grid.loadData()},finishLoad:function(n){this._itemsCount=n.itemsCount;this._grid.option("data",n.data)},finishInsert:function(){this._grid.search()},finishDelete:function(){this._grid.search()}};n.loadStrategies={DirectLoadingStrategy:i,PageLoadingStrategy:r}}(jsGrid,jQuery),function(n){var t=function(n){return typeof n!="undefined"&&n!==null},i={string:function(n,i){return!t(n)&&!t(i)?0:t(n)?t(i)?(""+n).localeCompare(""+i):1:-1},number:function(n,t){return n-t},date:function(n,t){return n-t},numberAsString:function(n,t){return parseFloat(n)-parseFloat(t)}};n.sortStrategies=i}(jsGrid,jQuery),function(n,t){function i(n){t.extend(!0,this,n);this.sortingFunc=this._getSortingFunc()}i.prototype={name:"",title:null,css:"",align:"",width:"auto",visible:!0,filtering:!0,inserting:!0,editing:!0,sorting:!0,sorter:"string",headerTemplate:function(){return this.title?this.title:this.name},itemTemplate:function(n){return n},filterTemplate:function(){return""},insertTemplate:function(){return""},editTemplate:function(n,t){return this._value=n,this.itemTemplate(n,t)},filterValue:function(){return""},insertValue:function(){return""},editValue:function(){return this._value},_getSortingFunc:function(){var i=this.sorter;if(t.isFunction(i))return i;if(typeof i=="string")return n.sortStrategies[i];throw Error('wrong sorter for the field "'+this.name+'"!');}};n.Field=i}(jsGrid,jQuery),function(n,t){function r(n){i.call(this,n)}var i=n.Field;r.prototype=new i({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var u=this._grid,i=this.filterControl=this._createTextBox(),r;if(this.autosearch){i.on("input paste",function(){clearTimeout(r);r=setTimeout(function(){u.search()},700);this.value?this.classList.add("graybackgroup"):this.classList.remove("graybackgroup")});let f=this._grid.controller.id;name=this.name;n.oakfn[f].autocomplete_rank.indexOf(name)>-1&&t.each(n.oakfn[f].autocomplete,function(n,t){if(n===name)return i.dropdown({source:t,minlength:0,fixposition:!0,trigger:function(){i.trigger("input")}}),!1})}return i},filterValue:function(){return this.filterControl[0].value},_createTextBox:function(){return t("<input>").attr("type","text").prop("readonly",!!this.readOnly)}});n.fields.text=n.TextField=r}(jsGrid,jQuery),function(n,t){function r(n){i.call(this,n)}var i=n.TextField;r.prototype=new i({sorter:"number",align:"left",readOnly:!1,filterValue:function(){return parseFloat(this.filterControl[0].value)||""},insertValue:function(){return parseInt(this.insertControl.val()||0,10)},editValue:function(){return parseInt(this.editControl.val()||0,10)},_createTextBox:function(){return t("<input>").attr("type","number").prop("readonly",!!this.readOnly)}});n.fields.number=n.NumberField=r}(jsGrid,jQuery),function(n,t,i){function u(n){r.call(this,n)}var r=n.Field;u.prototype=new r({sorter:"number",align:"center",autosearch:!0,itemTemplate:function(n){return this._createCheckbox().prop({checked:n,disabled:!0})},filterTemplate:function(){if(!this.filtering)return"";var i=this._grid,n=this.filterControl=this._createCheckbox();n.prop({readOnly:!0,indeterminate:!0});n.on("click",function(){var n=t(this);n.prop("readOnly")?n.prop({checked:!1,readOnly:!1}):n.prop("checked")||n.prop({readOnly:!0,indeterminate:!0})});if(this.autosearch)n.on("click",function(){i.search()});return n},insertTemplate:function(){return this.inserting?this.insertControl=this._createCheckbox():""},editTemplate:function(n){if(!this.editing)return this.itemTemplate(n);var t=this.editControl=this._createCheckbox();return t.prop("checked",n),t},filterValue:function(){return this.filterControl.get(0).indeterminate?i:this.filterControl.is(":checked")},insertValue:function(){return this.insertControl.is(":checked")},editValue:function(){return this.editControl.is(":checked")},_createCheckbox:function(){return t("<input>").attr("type","checkbox")}});n.fields.checkbox=n.CheckboxField=u}(jsGrid,jQuery),function(n,t){function r(n){i.call(this,n)}var i=n.TextField;r.prototype=new i({sorter:"date",filterValue:function(){return this.filterControl[0].value},_createTextBox:function(){return t("<input>").attr("type","text").prop("readonly",!!this.readOnly)}});n.fields.date=n.DateField=r}(jsGrid,jQuery),function(n,t){function u(n){r.call(this,n);this._configInitialized=!1}var r=n.Field;u.prototype=new r({css:"jsgrid-control-field",align:"center",width:80,filtering:!1,inserting:!1,editing:!1,sorting:!1,buttonClass:"jsgrid-button",deleteButtonClass:"jsgrid-delete-button",deleteButton:!0,headerTemplate:function(){return this._createFilterSwitchButton()},itemTemplate:function(n,i){var r=t([]);return this.deleteButton&&(r=r.add(this._createDeleteButton(i))),r},_createFilterSwitchButton:function(){let n=oakdef.griddelete_title||"Delete";return t('<label style="color:#c75959;">'+n+"<\/label>")},_createDeleteButton:function(n){return this._createGridButton(this.deleteButtonClass,this.deleteButtonTooltip,function(r){var u={};if(!r.onsave_delete)return r.deleteItem(n),!1;let f=function(n){let t={};for(i=0;i<r.fields.length;i++)if(r.fields[i].name){var u=r.fields[i].name,f=r.fields[i].title;t[f]=n[u]}return t},e=f(n);t.extend(u,e);userSaveFn=function(){return new Promise(function(n,t){u.resolve=n;u.reject=t;r.onsave_delete(u)})};userSaveFn().then(function(){r.deleteItem(n)})})},dialog_create:function(){t(".jsgrid-delete-dialog").each(function(n,i){t(i).dialog("dispose")});let n=document.createElement("div");n.classList.add("jsgrid-delete-dialog");let i=document.createElement("input");i.type="button";i.value=oakdef.griddelete_confirm;i.my_outline=n;i.classList.add("jsConfirmdeletebtn");i.addEventListener("click",this.ondeletor_confirm);let r=document.createElement("input");return r.type="button",r.my_outline=n,r.value=oakdef.griddelete_cancel,r.classList.add("jsConfirmdCancelbtn"),r.addEventListener("click",this.ondeletor_cancel),n.appendChild(i),n.appendChild(r),n},ondeletor_confirm:function(){let n=this.my_outline.my_btndelete.grid,i=this.my_outline.my_btndelete.clickHandler;i(n);t(this.my_outline).dialog("hide")},ondeletor_cancel:function(){t(this.my_outline).dialog("hide")},ondelete:function(){let n=this.dialog_create();n.my_btndelete=this;t(n).dialog({show:!0,backdrop:!0,position:{at:this,margin_right:oakdef.griddelete_right,margin_top:oakdef.griddelete_top},effect:"modal-fadein",title:oakdef.griddelete_dialog_title})},_createGridButton:function(n,i,r){let u=document.createElement("input");return u.type="button",u.grid=this._grid,u.clickHandler=r,u.dialog_create=this.dialog_create,u.ondeletor_confirm=this.ondeletor_confirm,u.ondeletor_cancel=this.ondeletor_cancel,u.classList.add("btngriddelete"),u.addEventListener("click",this.ondelete),t(u)}});n.fields.control=n.ControlField=u}(jsGrid,jQuery);