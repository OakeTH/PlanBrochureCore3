$(document).ready(function(){sharedFn={};sharedFn.loadingMessage={show:function(){$(divWebLoading).progressbar()},hide:function(){$(divWebLoading).progressbar.clear()}};sharedFn.warningBox=function(n){n||(n="ไม่พบข้อมูล");return $('<div class="error_warning_big"> <i class="fas fa-exclamation-circle mr10"><\/i>'+n+" <\/div>")};startupFn=function(){this.setupDefaultJqueryFunctions=function(){$.ajaxSetup({beforeSend:function(){sharedFn.loadingMessage.show()},complete:function(){sharedFn.loadingMessage.hide()},error:function(n){var t,r;if(n.status===404)return oak.minidialog({icon:"error",value:"Error 404 - Page Not Found"});try{if(t=JSON.parse(n.responseText),typeof t.errors=="object")for(r=Object.keys(t.errors),i=0;i<r.length;i++)oak.minidialog({icon:"error",value:t.errors[r[i]][0]});else typeof t.errors=="string"&&oak.minidialog({icon:"error",value:t.errors})}catch(u){oak.minidialog({icon:"error",value:n.responseText})}}});$.gridSetup({theme:"clear",excelbutton:!1,onemptydata:function(n){n.style.display="none";oak.minidialog({icon:"error",value:"ไม่พบข้อมูล"})}})};this.webFn=function(){window.webFn={}};this.user={authenticationAsync:function(){var n=this.getMainManu;return new Promise(function(t){$.ajax({url:SV.host+"authentication/getmenu",method:"POST",success:function(i){return window.webFn.Menu=n(i.menu),window.webFn.SubMenu=i.menu,window.webFn.UserInfo={roleName:i.roleName,employeeCode:i.employeeCode},t()}})})},createMenu:function(){this.createDiv=function(n){var t=document.createElement("div");return t.classList.add("btn"),t.innerText=n.text,t.myOption=n,t.addEventListener("click",this.renderPartailView),t};this.createIcon=function(n){var t=document.createElement("i");return t.classList.add("fas"),t.classList.add("fa-"+n.icon),t};this.renderPartailView=function(){var t="ssAGV_partailOf_",n=this.myOption,u=function(){this.createDiv=function(){var t=document.createElement("div");return t.classList.add("btn"),t.innerText=n.text,t.myOption=n,t};this.createIcon=function(){var t=document.createElement("i");return t.classList.add("fas"),t.classList.add("fa-"+n.icon),t};var t=this.createDiv(),i=this.createIcon();$(t).prepend(i).appendTo(".content-header")},f=function(){this.getSubMenu=function(){return window.webFn.SubMenu.filter(function(t){return t.iD_Menu_Main===n.id})};this.createLabel=function(n){var t=document.createElement("label");return t.innerText=n.subText,t.dataset.mycontainer=n.mycontainer,t};this.createIcon=function(n){var t=document.createElement("i");return t.style.color=n.subColor,t.classList.add("mr10"),t.classList.add("fas"),t.classList.add("fa-"+n.subIcon),t};this.build=function(){var n=this.getSubMenu(),t,r;for(i=0;i<n.length;i++)t=this.createLabel(n[i]),r=this.createIcon(n[i]),$(t).prepend(r).appendTo("#containerMenu .content-sub-menu"),i===0&&(t.dataset.defaultContainer=!0)};this.build()},r=function(n){u();f();eval(n.javascriptFn)};sessionStorage[t+n.id]?(divContainer.innerHTML=sessionStorage[t+n.id],r(n)):$.ajax({url:SV.host+n.partailViewUrl,beforeSend:function(){},complete:function(){},success:function(i){divContainer.innerHTML=i;sessionStorage[t+n.id]=i;r(n)}});$(".modal-backdrop").remove();$(".modal.modal-slidedown").remove()};this.applyActiveMenuCSS=function(){oak.activemenu({buttons:".btn",activecss:"btn-accept",onclick:function(){}})};this.build=function(){for(i=0;i<window.webFn.Menu.length;i++){var n=this.createDiv(window.webFn.Menu[i]),t=this.createIcon(window.webFn.Menu[i]);$(n).prepend(t);divUserMenu.appendChild(n)}this.applyActiveMenuCSS();$(divUserMenu).children("div.btn").first().trigger("click")};this.build()},setUserInfo:function(){spanUserFullName.innerText=window.webFn.UserInfo.employeeCode||""},getMainManu:function(n){return n.map(function(n){return{id:n.id,text:n.text,icon:n.icon,partailViewUrl:n.partailViewUrl,javascriptFn:n.javascriptFn}}).distinct()}};this.setupDefaultJqueryFunctions();this.webFn();this.user.authenticationAsync().then(function(){this.user.createMenu();this.user.setUserInfo()}).catch(function(){sharedFn.loadingMessage.hide();oak.minidialog({icon:"error",value:"Error"})})};startupFn()});$(document).ready(function(){window.webFn.planFn={getAsync:function(){return new Promise(function(n){window.webFn.plans?n(window.webFn.plans):$.ajax({url:SV.host+"plan/getPlans",success:function(t){window.webFn.plans=t;n(t)}})})},activeMenu:function(){oak.activemenu({buttons:".content-sub-menu label",activecss:"active"})},addInputEvent:function(){$(chkOnlyActive).checkboxes({source:[{text:"แสดงเฉพาะแผนประกันที่ยังขายอยู่"}],onchange:function(){window.webFn.planFn.ddlPlanSearch();$(ddlFindPlans).trigger("focus")}});$(btnClearPlanSearch).on("click",function(){ddlFindPlans.value="";var n=jQuery.Event("keydown",{keyCode:20});$(ddlFindPlans).trigger(n);window.webFn.planFn.reset()})},ddlPlanSearch:function(n){n||(n=window.webFn.plans);$(chkOnlyActive).checkboxes("get").all[0].checked&&(n=n.filter(function(n){return n.planShortNameTh.indexOf("error_msg")===-1}));$(ddlFindPlans).dropdown({source:n,height:"500px",width:"563px",groupby:"prodGrpNameTh",fixposition:!0}).on("change",function(n){n.bubbles||(divContent.style.display="",window.webFn.planFn.reset(),window.webFn.planFn.divPdfViewer(),window.webFn.planFn.divCommRate.prototype.renderGridAndInput())})},divPdfViewer:function(){this.render=function(){window.webFn.planFn.divPdfViewer.prototype.getPlanDocsAsync().then(function(n){var i,t;if(!n||!n.docFile)return $(divPdfViewer).empty().append(sharedFn.warningBox());t=function(n){return n.docFile.split(".").pop()}(n);n.docFile=encodeURI(n.docFile);n.docFile=n.docFile.replace("+","@@_push_@@");i=t=="pdf"?'<embed id="ifrPdfviewer" class="pdf-inline" src="'+SV.host+"Plan/DownloadDocByPlanCode?filename="+n.docFile+'#toolbar=0"/>':'<img id="ifrPdfviewer"  class="pdf-inline" src="'+SV.host+"Plan/DownloadDocByPlanCode?filename="+n.docFile+'"/>';lblPdffullscr.style.display="";var r=divContainer.getBoundingClientRect().height,u=r-225;$(divPdfViewer).empty().append(i);ifrPdfviewer.style.height=t!="pdf"?"auto":u+"px";$(lblPdffullscr).off("click").on("click",function(){window.open(SV.host+"Plan/DownloadDocByPlanCode?filename="+n.docFile,"_blank")})})};this.divPdfViewer.prototype.getPlanDocsAsync=function(){return new Promise(function(n){if(!ddlFindPlans.dataset.myvalue)return n();$.ajax({url:SV.host+"plan/GetFileNameByPlanCode",data:{planCode:ddlFindPlans.dataset.myvalue},success:function(t){n(t)}})})};this.render()},divPolicyValue:function(){this.setupInputs=function(){var n=this.renderGrid,t=function(){var t=$("<i>").addClass("fas fa-male pr-2").css("color","#f1af1f"),n=$("<label> ชาย<\/label>");return n.prepend(t),n[0].outerHTML},i=function(){var t=$("<i>").addClass("fas fa-female pr-2").css("color","rgb(68, 144, 206)"),n=$("<label> หญิง<\/label>");return n.prepend(t),n[0].outerHTML};$(txtPovAge).on("input",n);$(txtPovAge).on("keyup",function(n){n.which===13&&this.blur()});$(ddlPovGender).dropdown({source:[{value:"M",text:t()},{value:"F",text:i()}],placeholder:"",showsearchbox:!1,fixposition:!0}).on("change",function(){n({ignoreGetDataFromSV:!0})});$(txtEndYear).on("input",function(){n({ignoreGetDataFromSV:!0})});$(txtEndYear).on("keyup",function(n){n.which===13&&this.blur()})};this.renderGrid=function(n){window.webFn.planFn.divPolicyValue.prototype.getCVRateAsync(n).then(function(n){if(n){if(n=n.filter(function(n){return n.insuresex===ddlPovGender.value}),txtEndYear.value){var t=parseInt(txtEndYear.value);n=n.filter(function(n){return n.endyear===t})}$(divPolicyValue).grid({source:n,hideinternalsearch:!0,gridcss:"align-s-start",fields:[{fieldname:"insuresex",hide:!0},{fieldname:"endyear",title:"สิ้นปี กธ. ที่"},{fieldname:"cvrate",title:"เงินค่าเวนคืน กธ."},{fieldname:"rpurate",title:"กธ. ใช้เงินสำเร็จ_มูลค่าใช้เงินสำเร็จ"},{fieldname:"etirate",title:"กธ. ขยายระยะเวลา_เงินจ่ายคืนทันที"},{fieldname:"etiyear",title:"กธ. ขยายระยะเวลา_ปี"},{fieldname:"etiday",title:"กธ. ขยายระยะเวลา_วัน"},{fieldname:"rpurefund",title:"กธ. ใช้เงินสำเร็จ_เงินจ่ายคืนทันที"},{fieldname:"etirefund",title:"กธ. ขยายระยะเวลา_เงินจ่ายคืนทันที"}]})}})};this.divPolicyValue.prototype.getCVRateAsync=function(n){return n=n||{},new Promise(function(t){if(!txtPovAge.value)return t(null);if(!ddlFindPlans.dataset.myvalue||n.ignoreGetDataFromSV)return t(divPolicyValue.data);$.ajax({url:SV.host+"plan/getCVRate",contentType:"application/json",data:{prdplan:ddlFindPlans.dataset.myvalue,insureage:parseInt(txtPovAge.value)},success:function(n){return divPolicyValue.data=n,t(n)}})})};this.setupInputs()},divCommRate:function(){this.divCommRate.prototype.renderGridAndInput=function(n){window.webFn.planFn.divCommRate.prototype.getCommRateAsync(n).then(function(n){var o=function(){if(!n||!n.length)return $(divCommRate).empty().append(sharedFn.warningBox()),!0},u,t,f,i,e,r;o()||(u=n.map(function(n){return n["ทุนประกันภัย"]}),t=u.filter(function(n,t,i){return i.indexOf(n)===t}),t.push("-- ทั้งหมด --"),$(txtSumAssured).dropdown({source:t,fixposition:!0,showsearchbox:!1,value:"-- ทั้งหมด --"}),f=n.map(function(n){return n["อายุผู้เอาประกัน"]}),i=f.filter(function(n,t,i){return i.indexOf(n)===t}),i.push("-- ทั้งหมด --"),$(txtEntryAge).dropdown({source:i,fixposition:!0,showsearchbox:!1,value:"-- ทั้งหมด --"}),e=n.map(function(n){return n["ระยะชำระเบี้ย(ปี)"]}),r=e.filter(function(n,t,i){return i.indexOf(n)===t}),r.push("-- ทั้งหมด --"),$(txtTotalYear).dropdown({source:r,fixposition:!0,showsearchbox:!1,value:"-- ทั้งหมด --"}),window.webFn.planFn.divCommRate.prototype.renderGrid())})};this.divCommRate.prototype.getCommRateAsync=function(n){return n=n||{},new Promise(function(t){if(!ddlFindPlans.dataset.myvalue||n.ignoreGetDataFromSV)return t(divCommRate.data);$.ajax({url:SV.host+"plan/GetCommRate",data:{planCode:ddlFindPlans.dataset.myvalue},success:function(n){return divCommRate.data=n,t(n)}})})};this.divCommRate.prototype.renderGrid=function(){var n=divCommRate.data,t=txtSumAssured.value,i=txtEntryAge.value,r=txtTotalYear.value;t!=="-- ทั้งหมด --"&&(n=n.filter(function(n){return n["ทุนประกันภัย"]==t}));i!=="-- ทั้งหมด --"&&(n=n.filter(function(n){return n["อายุผู้เอาประกัน"]==i}));r!=="-- ทั้งหมด --"&&(n=n.filter(function(n){return n["ระยะชำระเบี้ย(ปี)"]==r}));$(divCommRate).grid({source:n,hideinternalsearch:!0,gridcss:"align-s-start",fields:[{fieldname:"รหัสแบบประกันภัย",hide:!0},{fieldname:"ทุนประกันภัย",width:150},{fieldname:"ปีที่ 1",width:70},{fieldname:"ปีที่ 2",width:70},{fieldname:"ปีที่ 3",width:70},{fieldname:"ปีที่ 4",width:70},{fieldname:"ปีที่ 5",width:70},{fieldname:"ปีที่ 6",width:70},{fieldname:"ปีที่ 7",width:70},{fieldname:"ปีที่ 8",width:70},{fieldname:"ปีที่ 9",width:70},{fieldname:"ปีที่ 10",width:70},{fieldname:"ปีที่ 11+",width:70},]})};this.setupInputs=function(){$("#txtSumAssured,#txtEntryAge,#txtTotalYear").on("change",function(){window.webFn.planFn.divCommRate.prototype.renderGrid()})};this.setupInputs()},reset:function(){divPdfViewer.innerHTML="";divPolicyValue.innerHTML="";divPdfViewer.innerHTML="";divCommRate.innerHTML="";txtPovAge.value="";ddlPovGender.value="";txtSumAssured.value="";txtEntryAge.value="";txtTotalYear.value=""},launch:function(){this.getAsync().then(function(n){window.webFn.planFn.activeMenu();window.webFn.planFn.addInputEvent();window.webFn.planFn.ddlPlanSearch(n);window.webFn.planFn.divPolicyValue();window.webFn.planFn.divCommRate()})}}});$(document).ready(function(){window.webFn.uploaddataFn={activeMenu:function(){oak.activemenu({buttons:".content-sub-menu label",activecss:"active"})},commRate:function(){this.setupButton=function(){updCommRate.addEventListener("click",function(){oak.excelimport({importto:"uploadData/UploadCommRate",onsuccess:function(n){$(divCommValidateResult).grid({source:n,excelbutton:!0,gridcss:"align-s-start",fields:[{fieldname:"import Result",width:250,css:"error_label"},{fieldname:"runNumber",hide:!0}]})},onerror:function(){oak.minidialog({value:oakdef.import_error,icon:"error"})}})});btnComRateTemplate.addEventListener("click",function(){oak.ajaxget.redirect({url:SV.host+"uploadData/DownloadCommRate",isTemplate:!0})});btnComRateDownload.addEventListener("click",function(){oak.ajaxget.redirect({url:SV.host+"uploadData/DownloadCommRate"})})};this.setupButton()},planInfo:function(){this.setupInput=function(){var n=function(n){var t=!0,i=n.files[0].type;return["application/pdf","image/jpeg","image/png"].indexOf(i)===-1&&(oak.minidialog({icon:"error",value:"อัพโหลดได้เฉพาะ pdf / jpeg / png"}),t=!1),t},t=function(n){var t=new FormData,i=n.files[0].name;t.append("file",n.files[0]);$.ajax({url:SV.host+"uploaddata/UploadPlanDocs",data:t,contentType:!1,processData:!1,method:"POST",success:function(n){oak.minidialog({value:"อัพโหลดไฟล์ "+i+" สำเร็จ",icon:"success"});$(divPlanDocsList).grid({source:n,paging:!1,excelbutton:!0,fields:[{fieldname:"ชื่อไฟล์",width:500,itemTemplate:function(n){var t=$("<div>"),i=$("<i>").addClass("fas fa-folder-open mr10");return t.append(i).append(n)}},{fieldname:"errors",forhide:!0}],onrowclick:function(n){var t=n.data.name.replace("+","@@_push_@@");window.open(SV.host+"Plan/DownloadDocByPlanCode?filename="+t,"_blank")}})}})},i=function(){return new Promise(function(n){$.ajax({url:SV.host+"UploadData/GetAllPlanDocFilesName",success:function(t){n(t)}})})},r=function(n){$.ajax({url:SV.host+"plan/DeleteDocs",method:"POST",data:{fileName:n.name},success:function(){n.resolve()}})},u=function(){i().then(function(n){$(divPlanDocsList).grid({source:n,excelbutton:!0,fields:[{fieldname:"name",width:600,itemTemplate:function(n){var t=$("<div>"),i=$("<i>").addClass("fas fa-folder-open mr10");return t.append(i).append(n)}},{fieldname:"errors",hide:!0}],remover:{onsave:function(n){r(n)}},onrowclick:function(n){var t=n.data.name.replace("+","@@_push_@@");window.open(SV.host+"Plan/DownloadDocByPlanCode?filename="+t,"_blank")}})})};$(updPlanDoc).upload({onchange:function(i){n(i)&&t(i)}});btnPlanDocDownload.addEventListener("click",u)};this.setupInput()},announceMath:function(){this.setupInput=function(){var n=function(n){if(n.files&&n.files.length!==0){var t=new FormData,i=n.files[0].name;t.append("file",n.files[0]);t.append("docsGroupName","คณิตศาสตร์ประกันภัย");t.append("DocsName",i);$.ajax({url:SV.host+"uploaddata/uploadAnnounceMathDocs",data:t,contentType:!1,processData:!1,method:"POST",success:function(){oak.minidialog({value:"อัพโหลดไฟล์ "+i+" สำเร็จ",icon:"success"})}})}},t=function(){return new Promise(function(n){$.ajax({url:SV.host+"announce/GetAnnounceMathDocs",success:function(t){n(t)}})})},i=function(n){$.ajax({url:SV.host+"announce/DeleteAnnounceMathDocs",data:{id:n.id},success:function(){n.resolve()}})},r=function(){t().then(function(n){$(divMathList).grid({source:n,excelbutton:!0,fields:[{fieldname:"ชื่อไฟล์",width:500,itemTemplate:function(n){var t=$("<div>"),i=$("<i>").addClass("fas fa-folder-open mr10");return t.append(i).append(n)}},{fieldname:"errors",hide:!0}],remover:{onsave:function(n){i(n)}},onrowclick:function(n){oak.ajaxpost.redirect({url:SV.host+"announce/DownLoadAnnounceMathDocsByDocsName",DocsName:n.data["ชื่อไฟล์"]})}})})};$(updAnnounceMathDocs).upload({onchange:function(t){n(t)}});btnShowAnnounceMathDocs.addEventListener("click",r)};this.setupInput()},launch:function(){window.webFn.uploaddataFn.activeMenu();window.webFn.uploaddataFn.commRate();window.webFn.uploaddataFn.planInfo();window.webFn.uploaddataFn.announceMath()}}});$(document).ready(function(){window.webFn.adminFn={activeMenu:function(){oak.activemenu({buttons:".content-sub-menu label",activecss:"active"})},divUser:function(){var n=function(){return new Promise(function(n){$.ajax({url:SV.host+"admin/getUsers",success:function(t){n(t)}})})},t=function(n){$.ajax({url:SV.host+"admin/insertUsers",method:"POST",data:{employeeCode:n.employeeCode,roleID:1},success:function(t){$.extend(n,t);n.roleName="Admin";n.resolve();oak.minidialog({value:"บันทึกสำเร็จ"})}})},r=function(n){$.ajax({url:SV.host+"admin/updateUsers",method:"POST",data:{id:n.id,employeeCode:n.employeeCode},success:function(){n.resolve();oak.minidialog({value:"บันทึกสำเร็จ"})}})},u=function(n){$.ajax({url:SV.host+"admin/deleteUsers",method:"POST",data:{id:n.id},success:function(t){oak.minidialog({value:"ลบข้อมูลสำเร็จ"});n.resolve(t)}})},f=function(){n().then(function(n){for(i=0;i<n.length;i++)delete n[i].menu,delete n[i].roleID,delete n[i].token,delete n[i].addBy;$(divUserList).grid({source:n,excelbutton:!0,fields:[{fieldname:"employeeCode",forupdate:!0,forinsert:!0,title:"รหัสพนักงาน"},{fieldname:"roleName",title:"สิทธิ์"}],inserter:{onsave:function(n){t(n)}},updater:{topicwidth:130,onsave:function(n){r(n)}},remover:{onsave:function(n){u(n)}}})})};f()},launch:function(){window.webFn.adminFn.activeMenu();window.webFn.adminFn.divUser()}}});$(document).ready(function(){window.webFn.announceFn={activeMenu:function(){oak.activemenu({buttons:".content-sub-menu label",activecss:"active"})},divMath:function(){var n=function(){return new Promise(function(n){$.ajax({url:SV.host+"announce/GetAnnounceMathDocs",success:function(t){n(t)}})})},t=function(){n().then(function(n){$(divAnnounceMathDocsList).grid({source:n,fields:[{fieldname:"ชื่อไฟล์",width:500,itemTemplate:function(n){var t=$("<div>"),i=$("<i>").addClass("fas fa-folder-open mr10");return t.append(i).append(n)}}],onrowclick:function(n){oak.ajaxpost.redirect({url:SV.host+"announce/DownLoadAnnounceMathDocsByDocsName",DocsName:n.data["ชื่อไฟล์"]})}})})};t()},launch:function(){window.webFn.announceFn.activeMenu();window.webFn.announceFn.divMath()}}});